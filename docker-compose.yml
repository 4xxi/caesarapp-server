version: '3.2'

services:
    php:
        build: ./config/docker/php
        depends_on:
            - redis
        volumes:
            - .:/var/www/html
        expose:
            - "9000"
        entrypoint: ./config/docker/docker-entrypoint.sh
        environment:
          - REDIS_URL
    nginx:
        image: 4xxi/nginx:flex
        depends_on:
            - php
        ports:
            - "${SERVER_HTTP_PORT}:80"
        volumes:
            - .:/var/www/html
            - ./var/log:/var/log/nginx
    redis:
        image: 'redis:alpine'
        environment:
          # ALLOW_EMPTY_PASSWORD is recommended only for development.
          - ALLOW_EMPTY_PASSWORD=yes
          - REDIS_URL
          - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL
        # labels:
        #   kompose.service.type: nodeport
        ports:
          - '6379:6379'
        volumes:
          - 'redis:/caesarapp/redis'
volumes:
    redis:
        driver: local
